# FormalFinance API v1

## Base

- Local default: `http://127.0.0.1:8080`
- Auth:
  - `X-API-Key: <key>` or `Authorization: Bearer <key>`
  - `GET /v1/healthz` is unauthenticated

## Endpoints

- `GET /v1/healthz`
- `GET /v1/profiles`
- `GET /v1/rulebook?profile=ixbrl-gating|fsd-consistency|companyfacts-consistency|all`
- `GET /v1/runs?limit=100&tenant_id=<id>`
- `GET /v1/metrics`
- `GET /v1/migrations`
- `POST /v1/ingest-accession`
- `POST /v1/validate`
- `POST /v1/certify`
- `POST /v1/replay-proof`
- `POST /v1/compare-baseline`
- `POST /v1/pilot-readiness`

## Validate Request

```json
{
  "tenant_id": "issuer-001",
  "profile": "ixbrl-gating",
  "filing": { "contexts": {}, "facts": [] },
  "llm": {
    "enabled": false,
    "provider": "none",
    "model": null,
    "base_url": null
  }
}
```

## Validate Response

```json
{
  "run_id": "uuid",
  "report": { "status": "clean" },
  "advisory": { "status": "disabled" },
  "proof": { "schema_version": "formalfinance.proof_bundle.v0" }
}
```

## Ingest Accession Request

```json
{
  "cik": "0000320193",
  "accession": "0000320193-26-000073",
  "user_agent": "FormalFinance/0.1.4 contact@example.com",
  "include_companyfacts": true
}
```

## Certify Response

- Includes `certificate` when `report.status == "clean"`.
- Includes `certificate_status: "not_issued"` otherwise.
- Includes signed certificate when service has signing configured.
- Set `include_proof: true` in request to include a proof bundle for replay.

## Replay Proof Request

```json
{
  "proof": { "schema_version": "formalfinance.proof_bundle.v0" },
  "report": { "schema_version": "formalfinance.report.v0" },
  "certificate": { "schema_version": "formalfinance.certificate.v0" },
  "signing_secret": "optional-secret",
  "require_certificate_signature": true,
  "lean": {
    "enabled": false,
    "bin": "lean",
    "timeout_seconds": 20
  }
}
```

## Error Codes

- `400` invalid JSON/request shape
- `401` unauthorized
- `403` IP allowlist reject
- `404` unknown route
- `413` request too large
- `429` rate limited
- `500` internal error

## Security Controls

- Request size bounded by `max_request_bytes`.
- Rate limiting per API key/IP.
- Optional CIDR allowlist.
